<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Index Constraints and Discrete Ranges</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    SPAN.insert6 {text-decoration: underline; color: rgb(0,51,204) }
    SPAN.delete6 {text-decoration: line-through; color: rgb(0,51,204) }
    A.Bar:link {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    A.Bar:visited {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.8em; margin-bottom: 0.6em}
    DIV.Indented1 {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.8em; margin-bottom: 0.6em}
    DIV.Notes {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 4.3em; margin-bottom: 0.6em}
    DIV.Annotations {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.8em; margin-bottom: 0.6em}
    DIV.Examples {font-family: "Courier New", monospace; font-size: 90%; line-height: 122%; margin-left: 4.0em; margin-bottom: 0.6em}
    DIV.Enumerated-Body {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.8em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Enumerated-Term {float: left; font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 2.3em; margin-top: 0em; margin-bottom: 0em}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><SPAN Style="font-size:200%; color: rgb(0,51,153)"><B>Annotated</B></SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)"><B>&nbsp;Ada Reference Manual</B> (Ada 202y Draft 4)</SPAN> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-3-6.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-3-6-2.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>3.6.1 Index Constraints and Discrete Ranges</H1>
<div class="paranum"><a name="p1">1</a></div>
<div class="Normal">An <SPAN Class="swiss"><A HREF="AA-3-6-1.html#S0057">index_constraint</A></SPAN> 
determines the range of possible values for every index of an array subtype, 
and thereby the corresponding array bounds.&nbsp;</div>

<H4 Class="centered">Syntax</H4>
<div class="paranum"><a name="p2">2</a></div>
<div class="Indented1"><SPAN Class="swiss">index_constraint</SPAN><A NAME="I2191"></A><A NAME="S0057"></A><SPAN Class="swiss">&nbsp;::=&nbsp;</SPAN>&nbsp;(<A NAME="I2192"></A><SPAN Class="swiss"><A HREF="AA-3-6-1.html#S0058">discrete_range</A></SPAN>&nbsp;{,&nbsp;<A NAME="I2193"></A><SPAN Class="swiss"><A HREF="AA-3-6-1.html#S0058">discrete_range</A></SPAN>})</div>
<div class="paranum"><a name="p3">3</a></div>
<div class="Indented1"><SPAN Class="swiss">discrete_range</SPAN><A NAME="I2194"></A><A NAME="S0058"></A><SPAN Class="swiss">&nbsp;::=&nbsp;</SPAN><I>discrete_</I><A NAME="I2195"></A><SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN>&nbsp;|&nbsp;<A NAME="I2196"></A><SPAN Class="swiss"><A HREF="AA-3-5.html#S0037">range</A></SPAN></div>

<H4 Class="centered">Name Resolution Rules</H4>
<div class="paranum"><a name="p4">4</a></div>
<div class="Normal"><A NAME="I2197"></A>The type of a <SPAN Class="swiss"><A HREF="AA-3-6-1.html#S0058">discrete_range</A></SPAN> 
is the type of the subtype defined by the <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN>, 
or the type of the <SPAN Class="swiss"><A HREF="AA-3-5.html#S0037">range</A></SPAN>. 
<A NAME="I2198"></A>For an <SPAN Class="swiss"><A HREF="AA-3-6-1.html#S0057">index_constraint</A></SPAN>, 
each <SPAN Class="swiss"><A HREF="AA-3-6-1.html#S0058">discrete_range</A></SPAN> 
shall resolve to be of the type of the corresponding index.&nbsp;</div>
<div class="paranum"><a name="p4.a">4.a</a></div>
<div class="Annotations"><B>Discussion:&nbsp;</B>In Ada 95, <SPAN Class="swiss"><A HREF="AA-3-6-1.html#S0057">index_constraint</A></SPAN>s 
only appear in a <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN>; 
they no longer appear in <SPAN Class="swiss"><A HREF="AA-3-6.html#S0054">constrained_array_definition</A></SPAN>s. 
</div>

<H4 Class="centered">Legality Rules</H4>
<div class="paranum"><a name="p5">5</a></div>
<div class="Normal">An <SPAN Class="swiss"><A HREF="AA-3-6-1.html#S0057">index_constraint</A></SPAN> 
shall appear only in a <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN> 
whose <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0028">subtype_mark</A></SPAN> 
denotes either an unconstrained array subtype, or an unconstrained access 
subtype whose designated subtype is an unconstrained array subtype; in 
either case, the <SPAN Class="swiss"><A HREF="AA-3-6-1.html#S0057">index_constraint</A></SPAN> 
shall provide a <SPAN Class="swiss"><A HREF="AA-3-6-1.html#S0058">discrete_range</A></SPAN> 
for each index of the array type.&nbsp;</div>

<H4 Class="centered">Static Semantics</H4>
<div class="paranum"><a name="p6">6</a></div>
<div class="Normal"><A NAME="I2199"></A>A <SPAN Class="swiss"><A HREF="AA-3-6-1.html#S0058">discrete_range</A></SPAN> 
defines a range whose bounds are given by the <SPAN Class="swiss"><A HREF="AA-3-5.html#S0037">range</A></SPAN>, 
or by the range of the subtype defined by the <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN>. 
</div>

<H4 Class="centered">Dynamic Semantics</H4>
<div class="paranum"><a name="p7">7</a></div>
<div class="Normal"><A NAME="I2200"></A>An <SPAN Class="swiss"><A HREF="AA-3-6-1.html#S0057">index_constraint</A></SPAN> 
is <I>compatible</I> with an unconstrained array subtype if and only 
if the index range defined by each <SPAN Class="swiss"><A HREF="AA-3-6-1.html#S0058">discrete_range</A></SPAN> 
is compatible (see <A HREF="AA-3-5.html">3.5</A>) with the corresponding 
index subtype. <A NAME="I2201"></A>If any of the <SPAN Class="swiss"><A HREF="AA-3-6-1.html#S0058">discrete_range</A></SPAN>s 
defines a null range, any array thus constrained is a <I>null array</I>, 
having no components. <A NAME="I2202"></A>An array value <I>satisfies</I> 
an <SPAN Class="swiss"><A HREF="AA-3-6-1.html#S0057">index_constraint</A></SPAN> 
if at each index position the array value and the <SPAN Class="swiss"><A HREF="AA-3-6-1.html#S0057">index_constraint</A></SPAN> 
have the same index bounds.&nbsp;</div>
<div class="paranum"><a name="p7.a">7.a</a></div>
<div class="Annotations"><B>Ramification:&nbsp;</B>There is no need to define 
compatibility with a constrained array subtype, because one is not allowed 
to constrain it again.</div>
<div class="paranum"><a name="p8">8</a></div>
<div class="Normal"><A NAME="I2203"></A>The elaboration of an <SPAN Class="swiss"><A HREF="AA-3-6-1.html#S0057">index_constraint</A></SPAN> 
consists of the evaluation of the <SPAN Class="swiss"><A HREF="AA-3-6-1.html#S0058">discrete_range</A></SPAN>(s), 
in an arbitrary order. <A NAME="I2204"></A>The evaluation of a <SPAN Class="swiss"><A HREF="AA-3-6-1.html#S0058">discrete_range</A></SPAN> 
consists of the elaboration of the <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN> 
or the evaluation of the <SPAN Class="swiss"><A HREF="AA-3-5.html#S0037">range</A></SPAN>.</div>
<div class="paranum"><a name="p9">9/6</a></div>
<div class="Normal" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI22s/AI22-0100-2.html">AI22-0100-2</A></I>} 
<span class="insert6">When the <I>upper bound is calculated</I><A NAME="I2205"></A><A NAME="I2206"></A> 
from the lower bound and another value representing the length of an 
array, the following steps are performed:</span></div>
<div class="paranum"><a name="p10">10/6</a></div>
<div class="Enumerated-Term">1.</div><div class="Enumerated-Body">
<span class="insert6">determine the position number of the lower bound, 
giving position number <I>L</I>;</span></div>
<div class="paranum"><a name="p11">11/6</a></div>
<div class="Enumerated-Term">2.</div><div class="Enumerated-Body">
<span class="insert6">add one less than the length value to <I>L</I>, 
giving the position number <I>U</I>; then</span></div>
<div class="paranum"><a name="p12">12/6</a></div>
<div class="Enumerated-Term">3.</div><div class="Enumerated-Body">
<span class="insert6">the value of the index type whose position number 
is <I>U</I> is the value of the upper bound; if there is no value of 
the index type whose position number is <I>U</I>, Constraint_Error is 
raised. <A NAME="I2207"></A></span></div>
<div class="paranum"><a name="p12.a">12.a/6</a></div>
<div class="Annotations"><span class="insert6"><B>Reason:&nbsp;</B>We use 
position numbers as they are calculated as <I>universal_integer</I>s, 
and thus have a theoretical unlimited range. For a static lower bound 
and length, the calculation should be exact. Using position numbers avoids 
problems that would be caused by using the index type for these calculations 
(no addition operation for enumeration types, and wrapping addition for 
modular types).</span>&nbsp;</div>
<div class="paranum"><a name="p12.b">12.b/6</a></div>
<div class="Annotations"><span class="insert6"><B>Implementation Note: 
</B><A HREF="AA-4-4.html">4.4</A> allows using type <I>root_integer</I> 
to evaluate <I>universal_integer</I> expressions that have to be evaluated 
at runtime. So long as overflow is detected, that is sufficient for almost 
all standard discrete types (overflow corresponding to cases where the 
value is not representable as a value of the index type). (But be careful, 
the subtract of 1 has to be done to the length, not the lower bound, 
lest an incorrect overflow happen if the lower bound is the first value 
of the base type.) For the largest modular type (that with a modulus 
of System.Max_Binary_Modulus), however, some of the position numbers 
are not representable as <I>root_integer</I>. For that type, it is preferable 
to use unsigned math that detects overflow when runtime evaluation is 
required. (On typical machines, that means testing the carry flag rather 
than the overflow flag after math operations.)</span>&nbsp;</div>
<div class="paranum"><a name="p12.c">12.c/6</a></div>
<div class="Annotations"><span class="insert6"><B>Ramification:&nbsp;</B>As 
with S'Val, raising Constraint_Error is part of the semantics of the 
operation; it is <I>not</I> a check and cannot be suppressed. It seemed 
important to keep this operation consistent with S'Val.</span>&nbsp;</div>
<div class="paranum"><a name="p13">13</a></div>
<div class="Notes">NOTE 1&nbsp;&nbsp;&nbsp;The elaboration of a <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN> 
consisting of a <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0028">subtype_mark</A></SPAN> 
followed by an <SPAN Class="swiss"><A HREF="AA-3-6-1.html#S0057">index_constraint</A></SPAN> 
checks the compatibility of the <SPAN Class="swiss"><A HREF="AA-3-6-1.html#S0057">index_constraint</A></SPAN> 
with the <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0028">subtype_mark</A></SPAN> 
(see <A HREF="AA-3-2-2.html">3.2.2</A>).</div>
<div class="paranum"><a name="p14">14</a></div>
<div class="Notes">NOTE 2&nbsp;&nbsp;&nbsp;Even if an array value does 
not satisfy the index constraint of an array subtype, Constraint_Error 
is not raised on conversion to the array subtype, so long as the length 
of each dimension of the array value and the array subtype match. See 
<A HREF="AA-4-6.html">4.6</A>.&nbsp;</div>

<H4 Class="centered">Examples</H4>
<div class="paranum"><a name="p15">15</a></div>
<div class="Normal" style="margin-bottom: 0.4em"><I>Examples of array 
declarations including an index constraint:</I>&nbsp;</div>
<div class="paranum"><a name="p16">16/5</a></div>
<div class="Examples">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0442-1.TXT">AI12-0442-1</A></I>} 
Board&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;Matrix(1&nbsp;..&nbsp;8,&nbsp;&nbsp;1&nbsp;..&nbsp;8);&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;see&nbsp;<A HREF="AA-3-6.html">3.6</A></I></SPAN><BR>
Rectangle&nbsp;:&nbsp;Matrix(1&nbsp;..&nbsp;20,&nbsp;1&nbsp;..&nbsp;30);<BR>
Inverse&nbsp;&nbsp;&nbsp;:&nbsp;Matrix(1&nbsp;..&nbsp;N,&nbsp;&nbsp;1&nbsp;..&nbsp;N);&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;N&nbsp;can&nbsp;be&nbsp;nonstatic</I></SPAN></div>
<div class="paranum"><a name="p17">17/5</a></div>
<div class="Examples" style="margin-bottom: 0.9em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00430.TXT">AI125-0430-1</A></I>} 
Filter&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;Bit_Vector(0&nbsp;..&nbsp;31);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;see&nbsp;<A HREF="AA-3-6.html">3.6</A></I></SPAN></div>
<div class="paranum"><a name="p18">18</a></div>
<div class="Normal" style="margin-bottom: 0.4em"><I>Example of array 
declaration with a constrained array subtype:</I>&nbsp;</div>
<div class="paranum"><a name="p19">19</a></div>
<div class="Examples" style="margin-bottom: 0.9em">My_Schedule&nbsp;:&nbsp;Schedule;&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;all&nbsp;arrays&nbsp;of&nbsp;type&nbsp;Schedule&nbsp;have&nbsp;the&nbsp;same&nbsp;bounds</I></SPAN></div>
<div class="paranum"><a name="p20">20</a></div>
<div class="Normal" style="margin-bottom: 0.4em"><I>Example of record 
type with a component that is an array:</I>&nbsp;</div>
<div class="paranum"><a name="p21">21</a></div>
<div class="Examples"><B>type</B>&nbsp;Var_Line(Length&nbsp;:&nbsp;Natural)&nbsp;<B>is</B><BR>
&nbsp;&nbsp;&nbsp;<B>record</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Image&nbsp;:&nbsp;String(1&nbsp;..&nbsp;Length);<BR>
&nbsp;&nbsp;&nbsp;<B>end</B>&nbsp;<B>record</B>;</div>
<div class="paranum"><a name="p22">22</a></div>
<div class="Examples">Null_Line&nbsp;:&nbsp;Var_Line(0);&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;Null_Line.Image&nbsp;is&nbsp;a&nbsp;null&nbsp;array</I></SPAN></div>

<H4 Class="centered">Extensions to Ada 83</H4>
<div class="paranum"><a name="p22.a">22.a</a></div>
<div class="Annotations"><A NAME="I2208"></A>We allow the declaration 
of a variable with a nominally unconstrained array subtype, so long as 
it has an initialization expression to determine its bounds.&nbsp;</div>

<H4 Class="centered">Wording Changes from Ada 83</H4>
<div class="paranum"><a name="p22.b">22.b</a></div>
<div class="Annotations">We have moved the syntax for <SPAN Class="swiss"><A HREF="AA-3-6-1.html#S0057">index_constraint</A></SPAN> 
and <SPAN Class="swiss"><A HREF="AA-3-6-1.html#S0058">discrete_range</A></SPAN> 
here since they are no longer used in <SPAN Class="swiss"><A HREF="AA-3-6.html#S0054">constrained_array_definition</A></SPAN>s. 
We therefore also no longer have to describe the (special) semantics 
of <SPAN Class="swiss"><A HREF="AA-3-6-1.html#S0057">index_constraint</A></SPAN>s 
and <SPAN Class="swiss"><A HREF="AA-3-6-1.html#S0058">discrete_range</A></SPAN>s 
that appear in <SPAN Class="swiss"><A HREF="AA-3-6.html#S0054">constrained_array_definition</A></SPAN>s.</div>
<div class="paranum"><a name="p22.c">22.c</a></div>
<div class="Annotations">The rules given in RM83-3.6.1(5,7-10), which 
define the bounds of an array object, are redundant with rules given 
elsewhere, and so are not repeated here. RM83-3.6.1(6), which requires 
that the (nominal) subtype of an array variable be constrained, no longer 
applies, so long as the variable is explicitly initialized.&nbsp;</div>

<H4 Class="centered">Wording Changes from Ada 2022</H4>
<div class="paranum"><a name="p22.d">22.d/6</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI22s/AI22-0100-2.html">AI22-0100-2</A></I>} 
<span class="insert6">Added a description of how the upper bound is calculated 
from a lower bound and a length. Having this description clarifies what 
happens in various boundary conditions (which were not previously specified, 
although the ACATS has tested some of those cases since the 1980s).</span> 
</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-3-6.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-3-6-2.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="vertical-align: middle; font-size:120%">Ada 2005 and 2012 Editions sponsored in part by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
